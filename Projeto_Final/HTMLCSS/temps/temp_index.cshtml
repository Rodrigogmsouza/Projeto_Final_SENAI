@using Projeto_Final.CSHARP;

@{
    Layout = null;

    //Conecta com o BD
    BancoDeDados.DBConnect();

    //Criar um objeto pessoa
    pessoa usuario = new pessoa();

    //Buscar os dados do formulario pelo método POST e inserir no objeto cliente
    usuario.cpf = Request.Form["cpfid"];
    usuario.senha = Request.Form["senhaid"];

    string nivel = Funcoes.Nivel_acesso(usuario);

    if (Funcoes.Login(usuario.cpf, usuario.senha))
    {

        HttpCookie cookie = new HttpCookie("UserLogin"); //Cria a estancia do obj HttpCookie passando o nome do mesmo
        cookie.Value = (nivel); //Define o valor do cookie
        DateTime dtNow = DateTime.Now; //Time para expiração (10 min)
        TimeSpan tsMinute = new TimeSpan(0, 0, 10, 0);
        cookie.Expires = dtNow + tsMinute;
        Response.Cookies.Add(cookie); //Adiciona o cookie

        //Redireciona o usuário para a área de logado
            <text>
                <script>
                    window.location.href = "/HTMLCSS/main.cshtml";
                </script>
            </text>
        }
        else
        {
            //Redireciona o usuário para a pagina inicial
            <text>
                <script>

                    window.location.href = "/HTMLCSS/Index.cshtml";
                    alert("SENHA OU CPF INCORRETOS, TENTE NOVAMENTE");
                </script>
            </text>
        }
    }